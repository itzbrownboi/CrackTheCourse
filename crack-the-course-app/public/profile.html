<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">

</head>

<body>
    <div class="min-h-screen bg-gray-50">
        <!-- Desktop View -->
        <div class="hidden-mobile desktop-view">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-content">
                    <div class="logo">
                        <img src="images/logo.jpeg" alt="logo" class="logo-icon">
                    </div>

                    <nav class="nav-menu">
                        <div class="nav-item">
                            <i class="fa-solid fa-house fa-lg"></i>
                            <span>Home</span>
                        </div>
                        <div class="nav-item">
                            <i class="fa-solid fa-circle-play fa-lg"></i>
                            <span>My Tutors</span>
                        </div>
                        <div class="nav-item">
                            <i class="fa-regular fa-message fa-lg"></i>
                            <span>Messages</span>
                        </div>
                        <div class="nav-item active">
                            <i class="fa-regular fa-user fa-lg"></i>
                            <span>My Profile</span>
                        </div>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="content-container">
                    <div class="edit-button">
                        <i data-lucide="edit-2"></i>
                    </div>

                    <!-- Profile Section -->
                    <div class="profile-section">
                        <img src="images/profile.png" alt="Profile" class="profile-image">
                        <h1 class="profile-name" id="profile-name">Stu Dent</h1>
                        <p class="profile-info" id="profile-info">3rd Year Computer Science Major</p>
                        <p class="profile-info" id="university-info">University of Calgary</p>
                    </div>

                    <!-- Conditional Course Section -->
                    <div class="courses-grid" id="courses-section">
                        <div class="course-section" id="student-courses-strong">
                            <h2>Strong Courses</h2>
                            <div class="course-list">
                                <p>MATH 265, CPSC 233, CPSC 251</p>
                            </div>
                        </div>
                        <div class="course-section" id="student-courses-weak">
                            <h2>Weak Courses</h2>
                            <div class="course-list">
                                <p>CPSC 355, SENG 513, MATH 211</p>
                            </div>
                        </div>
                        <div class="course-section" id="tutor-courses">
                            <h2>Courses I Teach</h2>
                            <div class="course-list">
                                <p>CPSC 233, CPSC 251, MATH 265</p>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Section -->
                    <div class="activity-section">
                        <h2>Activity</h2>
                        <div class="activity-list">
                            <div class="activity-item">
                                <i data-lucide="edit-2"></i>
                                <span>Created Account</span>
                            </div>
                            <div class="activity-item">
                                <i data-lucide="edit-2"></i>
                                <span>Updated Courses</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile View -->
        <div class="mobile-view">
            <div class="mobile-content">
                <div class="edit-button">
                    <i data-lucide="edit-2"></i>
                </div>
                
                <!-- Profile Section -->
                <div class="profile-section">
                    <img src="images/profile.png" alt="Profile" class="profile-image">
                    <h1 class="profile-name" id="profile-name-mobile">Stu Dent</h1>
                    <p class="profile-info" id="profile-info-mobile">3rd Year Computer Science Major</p>
                    <p class="profile-info" id="university-info-mobile">University of Calgary</p>
                </div>

                <!-- Conditional Mobile Course Section -->
                <div class="mobile-courses" id="mobile-courses-section">
                    <div class="course-section" id="student-courses-mobile-strong">
                        <h2>Strong Courses</h2>
                        <div class="course-list">
                            <p>CPSC 355, SENG 513, MATH 211</p>
                        </div>
                    </div>
                    <div class="course-section" id="student-courses-mobile-weak">
                        <h2>Weak Courses</h2>
                        <div class="course-list">
                            <p>CPSC 355, SENG 513, MATH 211</p>
                        </div>
                    </div>
                    <div class="course-section" id="tutor-courses-mobile">
                        <h2>Courses I Teach</h2>
                        <div class="course-list">
                            <p>CPSC 233, CPSC 251</p>
                        </div>
                    </div>
                </div>

                <!-- Activity Section -->
                <div class="activity-section">
                    <h2>Activity</h2>
                    <div class="activity-list">
                        <div class="activity-item">
                            <i data-lucide="edit-2"></i>
                            <span>Sent Request to Omar</span>
                        </div>
                        <div class="activity-item">
                            <i data-lucide="edit-2"></i>
                            <span>Tutoring with Tina</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Navigation -->
            <div class="mobile-nav">
                <i class="fa-solid fa-house"></i>
                <i class="fa-solid fa-circle-play"></i>
                <i class="fa-regular fa-message"></i>
                <i class="fa-regular fa-user"></i>
            </div>
        </div>
    </div>

    <script>
        // Retrieve the email from localStorage
        const userEmail = localStorage.getItem('userEmail');

        // Fetch profile data based on email
        if (userEmail) {
            fetch(`/api/profile?email=${userEmail}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error(data.error);
                        return;
                    }

                    // Update the profile information based on the returned data
                    const profileName = document.getElementById('profile-name');
                    const profileInfo = document.getElementById('profile-info');
                    const coursesSection = document.getElementById('courses-section');
                    const studentCoursesStrong = document.getElementById('student-courses-strong');
                    const studentCoursesWeak = document.getElementById('student-courses-weak');
                    const tutorCourses = document.getElementById('tutor-courses');
                    const studentCoursesMobileStrong = document.getElementById('student-courses-mobile-strong');
                    const studentCoursesMobileWeak = document.getElementById('student-courses-mobile-weak');
                    const tutorCoursesMobile = document.getElementById('tutor-courses-mobile');

                    profileName.textContent = `${data.firstName} ${data.lastName}`;
                    profileInfo.textContent = data.educationLevel;
                    
                    if (data.role === 'tutor') {
                        studentCoursesStrong.style.display = 'none';
                        studentCoursesWeak.style.display = 'none';
                        tutorCourses.style.display = 'block';
                        tutorCourses.innerHTML = `
                            <h2>Courses I Teach</h2>
                            <div class="course-list">
                                <p>${data.profile.teachCourses.join(', ')}</p>
                            </div>
                            `;

                        studentCoursesMobileStrong.style.display = 'none';
                        studentCoursesMobileWeak.style.display = 'none';
                        tutorCoursesMobile.style.display = 'block';

                        tutorCoursesMobile.innerHTML = `
                            <h2>Courses I Teach</h2>
                            <div class="course-list">
                                <p>${data.profile.teachCourses.join(', ')}</p>
                            </div>
                            `;
                    } else if (data.role === 'student') {
                        studentCoursesStrong.style.display = 'block';
                        studentCoursesStrong.innerHTML = `
                                <h2>Strong Courses</h2>
                                <div class="course-list">
                                    <p>${data.profile.strongCourses.join(', ')}</p>
                                </div>
                                `;
                        studentCoursesWeak.style.display = 'block';
                        studentCoursesWeak.innerHTML = `
                                <h2>Weak Courses</h2>
                                <div class="course-list">
                                    <p>${data.profile.weakCourses.join(', ')}</p>
                                </div>
                                `;
                        tutorCourses.style.display = 'none';
                        studentCoursesMobileStrong.style.display = 'block';
                        studentCoursesMobileStrong.innerHTML = `
                                <h2>Strong Courses</h2>
                                <div class="course-list">
                                    <p>${data.profile.strongCourses.join(', ')}</p>
                                </div>`
                        studentCoursesMobileWeak.style.display = 'block';
                        studentCoursesMobileWeak.innerHTML = `
                                <h2>Weak Courses</h2>
                                <div class="course-list">
                                    <p>${data.profile.weakCourses.join(', ')}</p>
                                </div>
                                `;
                        tutorCoursesMobile.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error fetching profile data:', error);
                });
        } else {
            console.error("User email not found in localStorage.");
        }
    </script>

</body>

</html>